```html
<!DOCTYPE html>
<html lang="en">
<!--
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    BOOKBUDDY DASHBOARD                       â•‘
â•‘  IoT Study Companion for 9th Grade Students                  â•‘
â•‘                                                              â•‘
â•‘  SETUP:                                                      â•‘
â•‘  1. Open this file in Chrome/Edge browser                    â•‘
â•‘  2. Enter your ESP32 IP address and click Connect            â•‘
â•‘  3. Or click "Demo Mode" to test without hardware            â•‘
â•‘                                                              â•‘
â•‘  FEATURES:                                                   â•‘
â•‘  - Real-time WebSocket connection to ESP32                   â•‘
â•‘  - Voice & text AI chat via ChatGPT                          â•‘
â•‘  - 4 interactive charts (Bar, Line, Doughnut, Area)          â•‘
â•‘  - Study insights & recommendations                          â•‘
â•‘  - RTC time sync                                             â•‘
â•‘  - CSV data export                                           â•‘
â•‘  - Fully responsive design                                   â•‘
â•‘                                                              â•‘
â•‘  API ENDPOINTS (ESP32):                                      â•‘
â•‘  GET  /api/status    - Current device status JSON            â•‘
â•‘  POST /api/synctime  - Sync RTC with {epoch: timestamp}     â•‘
â•‘  WS   /ws            - WebSocket for live updates            â•‘
â•‘                                                              â•‘
â•‘  BROWSER: Chrome 90+ or Edge 90+ recommended                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BookBuddy Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
  <style>
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: rgba(30, 41, 59, 0.85);
      --bg-card-hover: rgba(51, 65, 85, 0.9);
      --primary: #3b82f6;
      --primary-light: #60a5fa;
      --success: #22c55e;
      --success-dark: #10b981;
      --warning: #fbbf24;
      --error: #ef4444;
      --purple: #a78bfa;
      --pink: #f472b6;
      --orange: #fb923c;
      --text-primary: rgba(255, 255, 255, 0.95);
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.4);
      --border: rgba(255, 255, 255, 0.1);
      --radius: 16px;
      --radius-sm: 10px;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --transition: all 0.3s ease;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Times New Roman', Times, serif;
      background: linear-gradient(135deg, #0f172a 0%, #1a1a3e 40%, #0f172a 100%);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(ellipse at 20% 50%, rgba(59, 130, 246, 0.08) 0%, transparent 60%),
        radial-gradient(ellipse at 80% 20%, rgba(167, 139, 250, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, rgba(34, 197, 94, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 30px 0 20px;
    }

    .header h1 {
      font-size: clamp(2rem, 5vw, 3.2rem);
      font-weight: bold;
      background: linear-gradient(135deg, var(--primary-light), var(--purple), var(--pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .header p {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .card:hover {
      background: var(--bg-card-hover);
      border-color: rgba(255, 255, 255, 0.15);
    }

    .card-title {
      font-size: 1.3rem;
      font-weight: bold;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    /* Connection Panel */
    .connection-panel {
      margin-bottom: 24px;
    }

    .connection-inner {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
    }

    .connection-inner label {
      font-weight: bold;
      font-size: 1rem;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .ip-input {
      flex: 1;
      min-width: 200px;
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      background: rgba(15, 23, 42, 0.6);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1rem;
      outline: none;
      transition: var(--transition);
    }

    .ip-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-connect {
      background: linear-gradient(135deg, var(--primary), #2563eb);
      color: white;
    }

    .btn-demo {
      background: linear-gradient(135deg, #7c3aed, #6d28d9);
      color: white;
    }

    .btn-sync {
      background: linear-gradient(135deg, var(--success-dark), #059669);
      color: white;
    }

    .btn-export {
      background: linear-gradient(135deg, var(--orange), #ea580c);
      color: white;
    }

    .btn-reset {
      background: linear-gradient(135deg, var(--error), #dc2626);
      color: white;
    }

    .btn-voice {
      background: linear-gradient(135deg, var(--pink), #ec4899);
      color: white;
      padding: 15px 40px;
      font-size: 1.1rem;
    }

    .btn-text {
      background: linear-gradient(135deg, var(--success), var(--success-dark));
      color: white;
      padding: 15px 40px;
      font-size: 1.1rem;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: bold;
    }

    .status-badge.offline {
      background: rgba(239, 68, 68, 0.15);
      color: var(--error);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .status-badge.connected {
      background: rgba(34, 197, 94, 0.15);
      color: var(--success);
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .status-badge.connecting {
      background: rgba(251, 191, 36, 0.15);
      color: var(--warning);
      border: 1px solid rgba(251, 191, 36, 0.3);
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
    }

    .status-dot.offline { background: var(--error); }
    .status-dot.connected {
      background: var(--success);
      animation: pulse-dot 1.5s infinite;
    }
    .status-dot.connecting {
      background: var(--warning);
      animation: pulse-dot 0.8s infinite;
    }

    @keyframes pulse-dot {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.3); }
    }

    /* AI Chat Section */
    .ai-section {
      margin-bottom: 24px;
    }

    .ai-section .card-title {
      font-size: 1.5rem;
      text-align: center;
    }

    .ai-description {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 24px;
      font-size: 1.05rem;
    }

    .ai-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .listening-indicator {
      display: none;
      text-align: center;
      margin-top: 16px;
      padding: 16px;
      border: 2px solid var(--pink);
      border-radius: var(--radius-sm);
      background: rgba(244, 114, 182, 0.08);
      animation: listening-pulse 1.5s infinite;
    }

    .listening-indicator.active {
      display: block;
    }

    @keyframes listening-pulse {
      0%, 100% { border-color: var(--pink); }
      50% { border-color: rgba(244, 114, 182, 0.3); }
    }

    .listening-dot {
      display: inline-block;
      width: 12px;
      height: 12px;
      background: var(--pink);
      border-radius: 50%;
      margin-right: 10px;
      animation: pulse-dot 0.6s infinite;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      text-align: center;
      padding: 20px;
    }

    .stat-icon {
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 4px;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    .stat-value.happy { color: var(--success); }
    .stat-value.calm { color: var(--primary-light); }
    .stat-value.sad { color: var(--error); }
    .stat-value.proud { color: var(--warning); }
    .stat-value.neutral { color: var(--text-secondary); }

    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      margin-top: 10px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      border-radius: 4px;
      background: linear-gradient(90deg, var(--primary), var(--success));
      transition: width 0.5s ease;
    }

    /* Charts Grid */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
      margin-bottom: 24px;
    }

    .chart-container {
      position: relative;
      height: 320px;
    }

    /* Subject Table */
    .subject-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1rem;
    }

    .subject-table th {
      text-align: left;
      padding: 14px 16px;
      border-bottom: 2px solid var(--border);
      color: var(--text-secondary);
      font-weight: bold;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .subject-table td {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      transition: var(--transition);
    }

    .subject-table tr:nth-child(even) td {
      background: rgba(255, 255, 255, 0.02);
    }

    .subject-table tr.active td {
      background: rgba(34, 197, 94, 0.08);
    }

    .subject-table tr:hover td {
      background: rgba(255, 255, 255, 0.05);
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .status-indicator .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .status-indicator .dot.on { background: var(--success); box-shadow: 0 0 8px rgba(34, 197, 94, 0.5); }
    .status-indicator .dot.off { background: var(--text-muted); }

    /* Insights */
    .insights-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .insights-list li {
      padding: 14px 18px;
      background: rgba(255, 255, 255, 0.04);
      border-radius: var(--radius-sm);
      border-left: 4px solid var(--primary);
      font-size: 1rem;
      color: var(--text-secondary);
      transition: var(--transition);
    }

    .insights-list li:nth-child(2) { border-left-color: var(--success); }
    .insights-list li:nth-child(3) { border-left-color: var(--purple); }
    .insights-list li:nth-child(4) { border-left-color: var(--warning); }
    .insights-list li:nth-child(5) { border-left-color: var(--pink); }

    .insights-list li:hover {
      background: rgba(255, 255, 255, 0.07);
    }

    .insights-list li strong {
      color: var(--text-primary);
    }

    /* Controls */
    .controls-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 24px;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: var(--radius-sm);
      background: var(--bg-card);
      border: 1px solid var(--border);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      z-index: 9999;
      transform: translateX(120%);
      transition: transform 0.4s ease;
      max-width: 400px;
      font-size: 1rem;
    }

    .notification.show {
      transform: translateX(0);
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 30px 0;
      color: var(--text-muted);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 30px;
    }

    /* Section Gap */
    .section-gap {
      margin-bottom: 24px;
    }

    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    /* Focus styles */
    *:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
      .two-col {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      .container {
        padding: 12px;
      }
      .card {
        padding: 16px;
      }
      .header h1 {
        font-size: 1.8rem;
      }
      .connection-inner {
        flex-direction: column;
        align-items: stretch;
      }
      .ip-input {
        min-width: unset;
      }
      .btn-voice, .btn-text {
        padding: 14px 24px;
        font-size: 1rem;
        width: 100%;
        justify-content: center;
      }
      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }
      .controls-bar {
        flex-direction: column;
      }
      .controls-bar .btn {
        width: 100%;
        justify-content: center;
      }
      .chart-container {
        height: 260px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>ğŸ“š BookBuddy Dashboard</h1>
      <p>IoT Study Companion Â· Track Â· Learn Â· Grow</p>
    </header>

    <!-- Connection Panel -->
    <section class="connection-panel card" aria-label="Device Connection">
      <div class="connection-inner">
        <label for="ipInput">ğŸ”Œ ESP32 IP:</label>
        <input
          type="text"
          id="ipInput"
          class="ip-input"
          placeholder="Enter ESP32 IP (e.g., 10.152.138.159)"
          value="http://10.152.138.159"
          aria-label="ESP32 IP Address"
        >
        <button class="btn btn-connect" onclick="connectDevice()" aria-label="Connect to device">
          âš¡ Connect
        </button>
        <button class="btn btn-demo" onclick="startDemo()" aria-label="Start demo mode">
          ğŸ® Demo Mode
        </button>
        <span id="statusBadge" class="status-badge offline" role="status" aria-live="polite">
          <span class="status-dot offline" id="statusDot"></span>
          <span id="statusText">Offline</span>
        </span>
      </div>
    </section>

    <!-- AI Chat Section -->
    <section class="ai-section card" aria-label="AI Chat">
      <div class="card-title">ğŸ¤– Ask BookBuddy AI Anything!</div>
      <p class="ai-description">
        Need help with English, Hindi, Maths, Marathi, or Science? BookBuddy AI is here to help you!
      </p>
      <div class="ai-buttons">
        <button class="btn btn-voice" onclick="startVoiceChat()" aria-label="Talk to BookBuddy using voice">
          ğŸ¤ Talk to BookBuddy
        </button>
        <button class="btn btn-text" onclick="startTextChat()" aria-label="Chat with BookBuddy using text">
          ğŸ’¬ Chat with BookBuddy
        </button>
      </div>
      <div class="listening-indicator" id="listeningIndicator" role="alert" aria-live="assertive">
        <span class="listening-dot"></span>
        <strong>Listening... Speak now!</strong>
      </div>
    </section>

    <!-- Live Statistics Cards -->
    <section class="stats-grid" aria-label="Live Statistics">
      <div class="card stat-card">
        <div class="stat-icon">ğŸ“š</div>
        <div class="stat-value" id="bookCount">0/5</div>
        <div class="stat-label">Books Placed</div>
        <div class="progress-bar-container">
          <div class="progress-bar-fill" id="bookProgress" style="width: 0%"></div>
        </div>
      </div>
      <div class="card stat-card">
        <div class="stat-icon" id="emotionIcon">ğŸ˜</div>
        <div class="stat-value neutral" id="emotion">--</div>
        <div class="stat-label">Current Emotion</div>
      </div>
      <div class="card stat-card">
        <div class="stat-icon">ğŸ•</div>
        <div class="stat-value" id="deviceTime">--:--</div>
        <div class="stat-label">Device Time</div>
      </div>
      <div class="card stat-card">
        <div class="stat-icon">â±ï¸</div>
        <div class="stat-value" id="totalTime">0m</div>
        <div class="stat-label">Total Study Time</div>
      </div>
    </section>

    <!-- Controls Bar -->
    <section class="controls-bar" aria-label="Controls">
      <button class="btn btn-sync" onclick="syncTime()" aria-label="Sync RTC time">ğŸ”„ Sync RTC Time</button>
      <button class="btn btn-export" onclick="exportCSV()" aria-label="Export data as CSV">ğŸ“¥ Export CSV</button>
      <button class="btn btn-reset" onclick="resetStats()" aria-label="Reset statistics">ğŸ—‘ï¸ Reset Stats</button>
    </section>

    <!-- Charts -->
    <section class="charts-grid" aria-label="Charts">
      <div class="card">
        <div class="card-title">ğŸ“Š Reading Progress</div>
        <div class="chart-container">
          <canvas id="barChart"></canvas>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“ˆ Study Timeline</div>
        <div class="chart-container">
          <canvas id="lineChart"></canvas>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ© Subject Distribution</div>
        <div class="chart-container">
          <canvas id="doughnutChart"></canvas>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“¦ Books on Rack Over Time</div>
        <div class="chart-container">
          <canvas id="areaChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Subject Table + Insights -->
    <div class="two-col section-gap">
      <section class="card" aria-label="Subject Tracker">
        <div class="card-title">ğŸ“‹ Subject Tracker</div>
        <table class="subject-table" aria-label="Subject status and study time">
          <thead>
            <tr>
              <th>Subject</th>
              <th>Status</th>
              <th>Total Time</th>
            </tr>
          </thead>
          <tbody id="subjectTableBody">
            <tr><td>ğŸ“– English</td><td><span class="status-indicator"><span class="dot off"></span> Removed</span></td><td>0m</td></tr>
            <tr><td>ğŸ“• Hindi</td><td><span class="status-indicator"><span class="dot off"></span> Removed</span></td><td>0m</td></tr>
            <tr><td>ğŸ“ Maths</td><td><span class="status-indicator"><span class="dot off"></span> Removed</span></td><td>0m</td></tr>
            <tr><td>ğŸ“— Marathi</td><td><span class="status-indicator"><span class="dot off"></span> Removed</span></td><td>0m</td></tr>
            <tr><td>ğŸ”¬ Science</td><td><span class="status-indicator"><span class="dot off"></span> Removed</span></td><td>0m</td></tr>
          </tbody>
        </table>
      </section>
      <section class="card" aria-label="Study Insights">
        <div class="card-title">ğŸ’¡ Study Pattern Insights</div>
        <ul class="insights-list" id="insightsList">
          <li>ğŸ“š <strong>Most Studied:</strong> No data yet</li>
          <li>ğŸ”¥ <strong>Study Streak:</strong> 0 subjects studied</li>
          <li>â³ <strong>Avg Session:</strong> 0 minutes per subject</li>
          <li>ğŸŒŸ <strong>Peak Study Time:</strong> N/A</li>
          <li>ğŸ’ª <strong>Tip:</strong> Start studying to get personalized recommendations!</li>
        </ul>
      </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
      BookBuddy Dashboard &copy; 2024 &middot; Built for 9th Grade Students &middot; Made with â¤ï¸
    </footer>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification" role="alert" aria-live="polite"></div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  STATE & CONFIG
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let ws = null;
    let ESP32_IP = '';
    let demoInterval = null;
    let pollingInterval = null;
    let reconnectAttempts = 0;
    const MAX_RECONNECT = 3;
    let connected = false;
    let isDemoMode = false;

    const SUBJECTS = ['English', 'Hindi', 'Maths', 'Marathi', 'Science'];
    const SUBJECT_ICONS = ['ğŸ“–', 'ğŸ“•', 'ğŸ“', 'ğŸ“—', 'ğŸ”¬'];
    const SUBJECT_COLORS = [
      'rgba(96, 165, 250, 0.7)',
      'rgba(251, 146, 60, 0.7)',
      'rgba(167, 139, 250, 0.7)',
      'rgba(52, 211, 153, 0.7)',
      'rgba(251, 191, 36, 0.7)'
    ];
    const SUBJECT_BORDER_COLORS = [
      '#60a5fa', '#fb923c', '#a78bfa', '#34d399', '#fbbf24'
    ];

    let currentData = {
      status: 'offline',
      uptime: 0,
      emotion: '--',
      booksPlaced: 0,
      time: '',
      totalStudySeconds: 0,
      books: SUBJECTS.map(name => ({ name, present: false, totalSeconds: 0 }))
    };

    // Timeline data stores
    let timelineData = [];       // for line chart
    let booksOverTime = [];      // for area chart
    const MAX_TIMELINE = 200;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CHART INSTANCES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let barChart, lineChart, doughnutChart, areaChart;
    let lastChartUpdate = 0;
    const CHART_DEBOUNCE = 800; // ms

    function initCharts() {
      const defaultFont = { family: "'Times New Roman', Times, serif" };
      Chart.defaults.font = defaultFont;
      Chart.defaults.color = 'rgba(255,255,255,0.7)';

      // Bar Chart
      const barCtx = document.getElementById('barChart').getContext('2d');
      barChart = new Chart(barCtx, {
        type: 'bar',
        data: {
          labels: SUBJECTS,
          datasets: [{
            label: 'Reading Time (minutes)',
            data: [0, 0, 0, 0, 0],
            backgroundColor: SUBJECT_COLORS,
            borderColor: SUBJECT_BORDER_COLORS,
            borderWidth: 2,
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: { duration: 400 },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: ctx => `${ctx.parsed.y} minutes`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(255,255,255,0.06)' },
              ticks: { font: defaultFont }
            },
            x: {
              grid: { display: false },
              ticks: { font: defaultFont }
            }
          }
        }
      });

      // Line Chart (Timeline)
      const lineCtx = document.getElementById('lineChart').getContext('2d');
      lineChart = new Chart(lineCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Total Study Time (min)',
            data: [],
            borderColor: '#60a5fa',
            backgroundColor: 'rgba(96, 165, 250, 0.1)',
            fill: true,
            tension: 0.4,
            pointRadius: 3,
            pointBackgroundColor: '#60a5fa',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: { duration: 400 },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: ctx => `${ctx.parsed.y.toFixed(1)} minutes total`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(255,255,255,0.06)' },
              ticks: { font: defaultFont }
            },
            x: {
              grid: { display: false },
              ticks: { font: defaultFont, maxTicksLimit: 10 }
            }
          }
        }
      });

      // Doughnut Chart
      const doughnutCtx = document.getElementById('doughnutChart').getContext('2d');
      doughnutChart = new Chart(doughnutCtx, {
        type: 'doughnut',
        data: {
          labels: SUBJECTS,
          datasets: [{
            data: [1, 1, 1, 1, 1],
            backgroundColor: SUBJECT_COLORS,
            borderColor: 'rgba(15,23,42,0.8)',
            borderWidth: 3,
            hoverOffset: 10
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: { duration: 400 },
          cutout: '55%',
          plugins: {
            legend: {
              position: 'bottom',
              labels: { font: defaultFont, padding: 16 }
            },
            tooltip: {
              callbacks: {
                label: ctx => {
                  const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                  const pct = total > 0 ? ((ctx.parsed / total) * 100).toFixed(1) : 0;
                  return `${ctx.label}: ${ctx.parsed} min (${pct}%)`;
                }
              }
            }
          }
        }
      });

      // Area Chart (Books over time)
      const areaCtx = document.getElementById('areaChart').getContext('2d');
      areaChart = new Chart(areaCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Books on Rack',
            data: [],
            borderColor: '#a78bfa',
            backgroundColor: 'rgba(167, 139, 250, 0.15)',
            fill: true,
            stepped: true,
            pointRadius: 2,
            pointBackgroundColor: '#a78bfa',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: { duration: 400 },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: ctx => `${ctx.parsed.y} books`
              }
            }
          },
          scales: {
            y: {
              min: 0,
              max: 5,
              ticks: { stepSize: 1, font: defaultFont },
              grid: { color: 'rgba(255,255,255,0.06)' }
            },
            x: {
              grid: { display: false },
              ticks: { font: defaultFont, maxTicksLimit: 10 }
            }
          }
        }
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  UTILITY FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function formatDuration(totalSeconds) {
      if (!totalSeconds || totalSeconds <= 0) return '0m';
      const h = Math.floor(totalSeconds / 3600);
      const m = Math.floor((totalSeconds % 3600) / 60);
      if (h > 0) return `${h}h ${m}m`;
      return `${m}m`;
    }

    function getTimeLabel() {
      const now = new Date();
      return now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
    }

    function sanitizeIP(input) {
      let ip = input.trim();
      ip = ip.replace(/^https?:\/\//, '');
      ip = ip.replace(/\/+$/, '');
      ip = ip.replace(/\/.*$/, '');
      return ip;
    }

    function showNotification(msg) {
      const el = document.getElementById('notification');
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 3500);
    }

    function setStatus(status) {
      const badge = document.getElementById('statusBadge');
      const dot = document.getElementById('statusDot');
      const text = document.getElementById('statusText');

      badge.className = 'status-badge ' + status;
      dot.className = 'status-dot ' + status;

      if (status === 'connected') { text.textContent = 'Connected'; connected = true; }
      else if (status === 'connecting') { text.textContent = 'Connecting...'; connected = false; }
      else { text.textContent = 'Offline'; connected = false; }
    }

    function getEmotionEmoji(emotion) {
      const map = {
        'happy': 'ğŸ˜Š', 'calm': 'ğŸ˜Œ', 'sad': 'ğŸ˜¢', 'proud': 'ğŸ¤©',
        'focused': 'ğŸ§', 'bored': 'ğŸ˜´', 'excited': 'ğŸ¤—', 'neutral': 'ğŸ˜'
      };
      return map[(emotion || '').toLowerCase()] || 'ğŸ˜';
    }

    function getEmotionClass(emotion) {
      const e = (emotion || '').toLowerCase();
      if (['happy', 'excited'].includes(e)) return 'happy';
      if (['calm', 'focused'].includes(e)) return 'calm';
      if (['sad', 'bored'].includes(e)) return 'sad';
      if (['proud'].includes(e)) return 'proud';
      return 'neutral';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  DASHBOARD UPDATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateDashboard(data) {
      currentData = { ...currentData, ...data };

      // Stats Cards
      const booksPlaced = data.booksPlaced ?? 0;
      document.getElementById('bookCount').textContent = `${booksPlaced}/5`;
      document.getElementById('bookProgress').style.width = `${(booksPlaced / 5) * 100}%`;

      const emotion = data.emotion || '--';
      document.getElementById('emotion').textContent = emotion;
      document.getElementById('emotion').className = 'stat-value ' + getEmotionClass(emotion);
      document.getElementById('emotionIcon').textContent = getEmotionEmoji(emotion);

      if (data.time) {
        try {
          const d = new Date(data.time);
          document.getElementById('deviceTime').textContent =
            d.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: false });
        } catch {
          document.getElementById('deviceTime').textContent = '--:--';
        }
      }

      document.getElementById('totalTime').textContent = formatDuration(data.totalStudySeconds || 0);

      // Subject Table
      updateBookTable(data.books || []);

      // Charts (debounced)
      const now = Date.now();
      if (now - lastChartUpdate > CHART_DEBOUNCE) {
        lastChartUpdate = now;
        updateCharts(data);
      }

      // Insights
      updateInsights(data.books || []);
    }

    function updateBookTable(books) {
      const tbody = document.getElementById('subjectTableBody');
      let html = '';
      books.forEach((book, i) => {
        const icon = SUBJECT_ICONS[i] || 'ğŸ“–';
        const present = book.present;
        const dotClass = present ? 'on' : 'off';
        const statusText = present ? 'On Rack' : 'Removed';
        const rowClass = present ? 'active' : '';
        html += `<tr class="${rowClass}">
          <td>${icon} ${book.name}</td>
          <td><span class="status-indicator"><span class="dot ${dotClass}"></span> ${statusText}</span></td>
          <td>${formatDuration(book.totalSeconds || 0)}</td>
        </tr>`;
      });
      tbody.innerHTML = html;
    }

    function updateCharts(data) {
      const books = data.books || [];
      const minutes = books.map(b => Math.round((b.totalSeconds || 0) / 60));

      // Bar
      barChart.data.datasets[0].data = minutes;
      barChart.update('none');

      // Doughnut
      const doughData = minutes.map(m => m || 0);
      const hasData = doughData.some(v => v > 0);
      doughnutChart.data.datasets[0].data = hasData ? doughData : [1, 1, 1, 1, 1];
      doughnutChart.update('none');

      // Timeline
      const timeLabel = getTimeLabel();
      const totalMin = (data.totalStudySeconds || 0) / 60;
      timelineData.push({ time: timeLabel, value: totalMin });
      if (timelineData.length > MAX_TIMELINE) timelineData.shift();
      lineChart.data.labels = timelineData.map(d => d.time);
      lineChart.data.datasets[0].data = timelineData.map(d => d.value);
      lineChart.update('none');

      // Books over time
      booksOverTime.push({ time: timeLabel, value: data.booksPlaced || 0 });
      if (booksOverTime.length > MAX_TIMELINE) booksOverTime.shift();
      areaChart.data.labels = booksOverTime.map(d => d.time);
      areaChart.data.datasets[0].data = booksOverTime.map(d => d.value);
      areaChart.update('none');
    }

    function updateInsights(books) {
      if (!books || books.length === 0) return;

      const sorted = [...books].sort((a, b) => (b.totalSeconds || 0) - (a.totalSeconds || 0));
      const activeBooks = books.filter(b => (b.totalSeconds || 0) > 0);
      const totalSec = books.reduce((a, b) => a + (b.totalSeconds || 0), 0);
      const avgSec = activeBooks.length > 0 ? totalSec / activeBooks.length : 0;
      const avgMin = Math.round(avgSec / 60);

      const mostStudied = sorted[0];
      const mostMin = Math.round((mostStudied.totalSeconds || 0) / 60);

      const leastStudied = sorted[sorted.length - 1];
      const leastMin = Math.round((leastStudied.totalSeconds || 0) / 60);

      const now = new Date();
      const hour = now.getHours();
      let peakTime = 'N/A';
      if (totalSec > 0) {
        if (hour >= 6 && hour < 12) peakTime = 'Morning (6 AM - 12 PM)';
        else if (hour >= 12 && hour < 16) peakTime = 'Afternoon (12 PM - 4 PM)';
        else if (hour >= 16 && hour < 20) peakTime = 'Evening (4 PM - 8 PM)';
        else peakTime = 'Night (8 PM - 6 AM)';
      }

      let tip = 'Start studying to get personalized recommendations!';
      if (activeBooks.length >= 3 && leastMin < avgMin * 0.5) {
        tip = `Try spending more time on <strong>${leastStudied.name}</strong> to balance your subjects.`;
      } else if (activeBooks.length >= 4) {
        tip = `Amazing balance! Keep up the great work across all subjects! ğŸŒŸ`;
      } else if (activeBooks.length >= 1) {
        const unstudied = books.filter(b => (b.totalSeconds || 0) === 0).map(b => b.name).join(', ');
        if (unstudied) tip = `Don't forget to study: <strong>${unstudied}</strong>`;
      }

      const list = document.getElementById('insightsList');
      list.innerHTML = `
        <li>ğŸ“š <strong>Most Studied:</strong> ${mostStudied.name} (${mostMin} min)</li>
        <li>ğŸ”¥ <strong>Study Streak:</strong> ${activeBooks.length} subject${activeBooks.length !== 1 ? 's' : ''} studied today</li>
        <li>â³ <strong>Avg Session:</strong> ${avgMin} minutes per subject</li>
        <li>ğŸŒŸ <strong>Peak Study Time:</strong> ${peakTime}</li>
        <li>ğŸ’ª <strong>Tip:</strong> ${tip}</li>
      `;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CONNECTION LOGIC
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function connectDevice() {
      stopDemo();
      if (pollingInterval) { clearInterval(pollingInterval); pollingInterval = null; }
      if (ws) { ws.close(); ws = null; }

      ESP32_IP = sanitizeIP(document.getElementById('ipInput').value);
      if (!ESP32_IP) {
        showNotification('âš ï¸ Please enter a valid IP address.');
        return;
      }

      setStatus('connecting');
      reconnectAttempts = 0;
      attemptWebSocket();
    }

    function attemptWebSocket() {
      try {
        ws = new WebSocket(`ws://${ESP32_IP}/ws`);

        ws.onopen = () => {
          setStatus('connected');
          reconnectAttempts = 0;
          showNotification('âœ… Connected to BookBuddy via WebSocket!');
        };

        ws.onmessage = (event) => {
          try {
            const data = JSON.parse(event.data);
            updateDashboard(data);
          } catch (e) {
            console.error('Invalid JSON from WebSocket:', e);
          }
        };

        ws.onerror = () => {
          console.warn('WebSocket error, falling back to HTTP polling...');
          ws.close();
        };

        ws.onclose = () => {
          if (connected) {
            showNotification('âš ï¸ WebSocket disconnected.');
          }
          setStatus('offline');
          ws = null;

          if (reconnectAttempts < MAX_RECONNECT) {
            reconnectAttempts++;
            showNotification(`ğŸ”„ Reconnecting... (attempt ${reconnectAttempts}/${MAX_RECONNECT})`);
            setStatus('connecting');
            setTimeout(attemptWebSocket, 2000);
          } else {
            showNotification('ğŸ“¡ Falling back to HTTP polling...');
            startHTTPPolling();
          }
        };
      } catch {
        startHTTPPolling();
      }
    }

    function startHTTPPolling() {
      if (pollingInterval) return;

      async function poll() {
        try {
          const res = await fetch(`http://${ESP32_IP}/api/status`, { signal: AbortSignal.timeout(5000) });
          const data = await res.json();
          if (!connected) {
            setStatus('connected');
            showNotification('âœ… Connected via HTTP polling.');
          }
          updateDashboard(data);
        } catch {
          setStatus('offline');
        }
      }

      poll();
      pollingInterval = setInterval(poll, 3000);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  DEMO MODE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function startDemo() {
      if (ws) { ws.close(); ws = null; }
      if (pollingInterval) { clearInterval(pollingInterval); pollingInterval = null; }
      if (demoInterval) { clearInterval(demoInterval); }

      isDemoMode = true;
      setStatus('connected');
      showNotification('ğŸ® Demo mode started! Simulating device...');

      let demoBooks = SUBJECTS.map(name => ({
        name,
        present: Math.random() > 0.5,
        totalSeconds: Math.floor(Math.random() * 1800)
      }));

      function tick() {
        // Randomly toggle 0-1 books
        if (Math.random() < 0.35) {
          const idx = Math.floor(Math.random() * 5);
          demoBooks[idx].present = !demoBooks[idx].present;
        }

        // Increment time for present books
        demoBooks.forEach(book => {
          if (book.present) book.totalSeconds += 2;
        });

        const count = demoBooks.filter(b => b.present).length;
        const emotions = ['Sad', 'Bored', 'Calm', 'Happy', 'Focused', 'Proud'];
        const emotion = count >= 4 ? emotions[5] : count >= 3 ? emotions[3] : count >= 2 ? emotions[2] : count >= 1 ? emotions[1] : emotions[0];

        updateDashboard({
          status: 'live',
          uptime: Date.now() / 1000,
          emotion,
          booksPlaced: count,
          time: new Date().toISOString(),
          totalStudySeconds: demoBooks.reduce((a, b) => a + b.totalSeconds, 0),
          books: demoBooks.map(b => ({ ...b }))
        });
      }

      tick();
      demoInterval = setInterval(tick, 2000);
    }

    function stopDemo() {
      if (demoInterval) { clearInterval(demoInterval); demoInterval = null; }
      isDemoMode = false;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  AI CHAT (Voice + Text)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function openChatGPTWithContext(userMessage = '') {
      const systemPrompt = `You are BookBuddy, a warm and enthusiastic AI study companion for 9th grade Indian students.

SUBJECTS YOU HELP WITH:
- English (grammar, writing, literature)
- Hindi (à¤µà¥à¤¯à¤¾à¤•à¤°à¤£, à¤²à¥‡à¤–à¤¨, à¤¸à¤¾à¤¹à¤¿à¤¤à¥à¤¯)
- Maths (algebra, geometry, arithmetic)
- Marathi (à¤µà¥à¤¯à¤¾à¤•à¤°à¤£, à¤²à¥‡à¤–à¤¨)
- Science (physics, chemistry, biology)

YOUR PERSONALITY:
- Friendly and encouraging
- Patient and supportive
- Use simple, clear language
- Give practical examples from daily life
- Celebrate student progress
- Make learning fun with emojis ğŸ“šâœ¨
- Break complex topics into easy steps

YOUR TEACHING STYLE:
1. Start with a warm greeting
2. Understand the question fully
3. Explain step-by-step with examples
4. Provide practice problems when relevant
5. End with encouragement and next steps

IMPORTANT RULES:
- Always be positive and supportive
- Use age-appropriate language (9th grade level)
- Relate concepts to real-world examples
- If question is unclear, ask for clarification
- Encourage independent thinking
- Use mix of English and subject language when helpful

Now respond to the student as BookBuddy!`;

      const fullPrompt = userMessage
        ? `${systemPrompt}\n\nStudent asks: "${userMessage}"\n\nRespond as BookBuddy:`
        : `${systemPrompt}\n\nGreet the student warmly as BookBuddy and ask how you can help them today!`;

      const chatURL = `https://chatgpt.com/?model=gpt-4&q=${encodeURIComponent(fullPrompt)}`;
      window.open(chatURL, '_blank');
    }

    function startVoiceChat() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert('Voice recognition is not supported in this browser. Please use Chrome or Edge, or try the text chat option.');
        return;
      }

      const recognition = new SpeechRecognition();
      recognition.lang = 'en-IN';
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      const indicator = document.getElementById('listeningIndicator');
      indicator.classList.add('active');

      recognition.start();

      recognition.onresult = (event) => {
        indicator.classList.remove('active');
        const transcript = event.results[0][0].transcript;
        showNotification(`ğŸ¤ You said: "${transcript}"`);
        openChatGPTWithContext(transcript);
      };

      recognition.onerror = (event) => {
        indicator.classList.remove('active');
        if (event.error === 'not-allowed') {
          alert('Microphone access denied. Please allow microphone permission in your browser settings.');
        } else {
          alert('Could not understand. Please try again or use text chat.');
        }
      };

      recognition.onend = () => {
        indicator.classList.remove('active');
      };
    }

    function startTextChat() {
      const question = prompt('Ask BookBuddy anything about your subjects:');
      if (question && question.trim()) {
        openChatGPTWithContext(question.trim());
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CONTROLS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function syncTime() {
      if (!ESP32_IP && !isDemoMode) {
        showNotification('âš ï¸ Not connected. Enter IP and connect first.');
        return;
      }
      if (isDemoMode) {
        showNotification('âœ… RTC synced to: ' + new Date().toLocaleTimeString());
        return;
      }

      try {
        const epoch = Math.floor(Date.now() / 1000);
        const response = await fetch(`http://${ESP32_IP}/api/synctime`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ epoch })
        });
        const result = await response.json();
        if (result.success) {
          showNotification('âœ… RTC synced to: ' + (result.newTime || new Date().toLocaleTimeString()));
        } else {
          showNotification('âŒ Sync failed: ' + (result.error || 'Unknown error'));
        }
      } catch (e) {
        showNotification('âŒ Could not reach device for time sync.');
      }
    }

    function exportCSV() {
      const books = currentData.books || [];
      if (books.every(b => (b.totalSeconds || 0) === 0)) {
        showNotification('âš ï¸ No data to export yet.');
        return;
      }

      const now = new Date().toISOString().split('T')[0];
      let csv = 'Subject,Date,Duration (seconds),Duration (formatted)\n';
      books.forEach(book => {
        csv += `${book.name},${now},${book.totalSeconds || 0},"${formatDuration(book.totalSeconds || 0)}"\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `bookbuddy-data-${now}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      showNotification('ğŸ“¥ CSV exported successfully!');
    }

    function resetStats() {
      if (!confirm('Are you sure you want to reset all statistics? This cannot be undone.')) return;

      currentData.books.forEach(b => { b.totalSeconds = 0; b.present = false; });
      currentData.totalStudySeconds = 0;
      currentData.booksPlaced = 0;
      currentData.emotion = '--';

      timelineData = [];
      booksOverTime = [];

      updateDashboard(currentData);
      showNotification('ğŸ—‘ï¸ Stats reset successfully.');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('DOMContentLoaded', () => {
      initCharts();
      updateDashboard(currentData);
    });
  </script>
</body>
</html>
```
